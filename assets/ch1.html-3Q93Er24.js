import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,b as l,a,e as n,o as r}from"./app-ZcIR9jDE.js";const o={};function s(m,e){return r(),i("div",null,[e[0]||(e[0]=l("p",null,"MiniLSM源码阅读（一）",-1)),a(" more "),e[1]||(e[1]=n('<h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景</span></a></h2><p><a href="https://www.skyzh.dev/" target="_blank" rel="noopener noreferrer">迟sir</a>的教学性质的LSM+Rust项目：</p><ul><li>项目链接：<a href="https://github.com/skyzh/mini-lsm" target="_blank" rel="noopener noreferrer">https://github.com/skyzh/mini-lsm</a></li><li>教程文档：<a href="https://skyzh.github.io/mini-lsm/" target="_blank" rel="noopener noreferrer">https://skyzh.github.io/mini-lsm</a></li></ul><h2 id="总体架构" tabindex="-1"><a class="header-anchor" href="#总体架构"><span>总体架构</span></a></h2><p>LSM存储引擎一般包括三个部分：</p><ul><li>wal(write-ahead log)：预写日志文件；</li><li>sstable(static string table)：磁盘中分层有序key-value对文件；</li><li>memtable/immutable memtable(后文简称immutable)：内存中有序key-value对结构。</li></ul><p>存储引擎一般会提供一下接口：</p><ul><li><code>Put(key, value)</code>：数据添加或修改；</li><li><code>Delete(key)</code>：数据删除；</li><li><code>Get(key)</code>：数据单点查询；</li><li><code>Scan(range)</code>：数据范围查询；</li><li><code>Txn()</code>：事务操作。</li></ul><h3 id="写流程" tabindex="-1"><a class="header-anchor" href="#写流程"><span>写流程</span></a></h3><figure><img src="https://cdn.jsdelivr.net/gh/starsflow/imgbed/blogs/minilsm-rust-1-2024-11-09-17-15-05.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>写操作主要包括以下四步：</p><ol><li>预写日志，将修改保存至key-value对保存至磁盘中的wal中；</li><li>将key-value写入memtable，到这一步用户线程操作结束；</li><li>（后台flush线程）当mem-table满了之后将其冻结成immutable mem-table，然后写入磁盘中的SST中；</li><li>（后台compact线程）当某一层SST满了之后进行压缩合并至下一层的sstable，以保持LSM-Tree的数据结构。</li></ol><p>写操作包括修改和删除操作，其中删除操作实际上就是value为空的修改操作。</p><h3 id="读流程" tabindex="-1"><a class="header-anchor" href="#读流程"><span>读流程</span></a></h3><figure><img src="https://cdn.jsdelivr.net/gh/starsflow/imgbed/blogs/minilsm-rust-1-2024-11-09-17-18-01.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>读操作主要包括以下两步：</p><ol><li>按照从新到旧的顺序在memtable/immutable中检索；</li><li>没找到的话会在磁盘中LSM-Tree的每一层sstable进行检索。</li></ol><p>查询操作包括单点查询和范围查询，范围查询的关键是通过单点查询获取其起始边界的位置，然后再该起始点顺序访问。</p><p>上述流程只是简单的概括介绍，由于使用了多版本机制实际的读写流程要复杂一些。</p>',19))])}const d=t(o,[["render",s],["__file","ch1.html.vue"]]),h=JSON.parse(`{"path":"/blog/minilsm-rust/ch1.html","title":"MiniLSM概览","lang":"zh-CN","frontmatter":{"title":"MiniLSM概览","index":true,"date":"2024-09-23T00:00:00.000Z","order":1,"lastUpdated":true,"category":["日常笔记"],"tag":["lsm","kv存储","源码阅读"],"description":"MiniLSM源码阅读（一）","head":[["meta",{"property":"og:url","content":"https://reolee.me/blog/minilsm-rust/ch1.html"}],["meta",{"property":"og:site_name","content":"Reo Lee's Blog"}],["meta",{"property":"og:title","content":"MiniLSM概览"}],["meta",{"property":"og:description","content":"MiniLSM源码阅读（一）"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cdn.jsdelivr.net/gh/starsflow/imgbed/blogs/minilsm-rust-1-2024-11-09-17-15-05.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-24T15:10:20.000Z"}],["meta",{"property":"article:tag","content":"lsm"}],["meta",{"property":"article:tag","content":"kv存储"}],["meta",{"property":"article:tag","content":"源码阅读"}],["meta",{"property":"article:published_time","content":"2024-09-23T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-11-24T15:10:20.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MiniLSM概览\\",\\"image\\":[\\"https://cdn.jsdelivr.net/gh/starsflow/imgbed/blogs/minilsm-rust-1-2024-11-09-17-15-05.png\\",\\"https://cdn.jsdelivr.net/gh/starsflow/imgbed/blogs/minilsm-rust-1-2024-11-09-17-18-01.png\\"],\\"datePublished\\":\\"2024-09-23T00:00:00.000Z\\",\\"dateModified\\":\\"2024-11-24T15:10:20.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Reo Lee\\"}]}"]]},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[]},{"level":2,"title":"总体架构","slug":"总体架构","link":"#总体架构","children":[{"level":3,"title":"写流程","slug":"写流程","link":"#写流程","children":[]},{"level":3,"title":"读流程","slug":"读流程","link":"#读流程","children":[]}]}],"git":{"createdTime":1731156930000,"updatedTime":1732461020000,"contributors":[{"name":"shinsten","email":"shinsten.li@gmail.com","commits":3}]},"readingTime":{"minutes":1.66,"words":498},"filePathRelative":"blog/minilsm-rust/ch1.md","localizedDate":"2024年9月23日","excerpt":"<p>MiniLSM源码阅读（一）</p>\\n","autoDesc":true}`);export{d as comp,h as data};
